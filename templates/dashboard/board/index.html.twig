{% extends "dashboard/index.html.twig" %}

{% block javascripts %}
    {{ parent() }}
    <link  rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <script src="{{ asset('js/status_transitions.js') }}"></script>
    <script src="{{ asset('js/board.js') }}"></script>
{% endblock %}

{% block content %}
    {{ parent() }}

    <div id="dndFlash" class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index:1080; width: 480px;"></div>

    <div class="container">
        <div class="header">
            <h3 class="mb-0">Board — {{ project.title }}</h3>

            {% if project.isScrumProject %}
                {% if activeSprint %}
                    <div class="text-muted small mt-1">
                        Sprint: <strong>{{ activeSprint.name }}</strong>
                        ({{ activeSprint.plannedStartAt|date('d.m.Y') }} – {{ activeSprint.plannedEndAt|date('d.m.Y') }})
                    </div>
                {% else %}
                    <div class="badge text-bg-warning mt-2" title="No active sprint">
                        No active sprint — board shows empty columns.
                    </div>
                {% endif %}
            {% endif %}
            <div class="search-group">
                <form id="boardSearchForm" class="d-flex gap-2" autocomplete="off">
                    <input id="boardSearch" type="text" class="form-control" placeholder="Search tickets...">
                    <button class="btn btn-outline-secondary" type="submit">Go</button>
                    <button class="btn btn-link" id="boardSearchClear" type="button" title="Clear">&times;</button>
                </form>
            </div>
            <button type="button"
                    class="btn btn-primary js-create-ticket"
                    data-url="{{ path('dashboard_ticket_create_form', { key: project.key }) }}">
                Create Ticket
            </button>
        </div>

        <div id="boardGrid"
             class="grid"
             data-search-url="{{ path('dashboard_board_search', { key: project.key }) }}"
        >
            {% include 'dashboard/board/board_columns.html.twig' with { statuses: workflowStatuses, ticketsByStatus: ticketsByStatus, project: project } %}
        </div>
    </div>

    <div class="modal fade" id="ticketModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" id="ticketModalContent"></div>
        </div>
    </div>

    <div class="modal fade" id="createTicketModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" id="createTicketModalContent"></div>
        </div>
    </div>

    <script>
        tinymce.init({
            selector: 'textarea.tinymce',
            plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount',
            toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat',
        });
    </script>
{% endblock %}